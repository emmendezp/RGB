<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Taller 2 : 3D Webgl Application # Planteamiento del problema # Implementación de una aplicación webgl 3d. a través de la utilización de p5.treegl o otra librería.
Main spaces # Sistema Tierra-Luna : # La luna es para el planeta tierra eje fundamental de estaciones y mareas, los científicos creen que un objeto del tamaño de Marte colisionó con la Tierra hace 4.500 millones de años. La fuerza de esta colisión fue tan impresionante que desprendió materiales de la Tierra y del objeto con el que colisionó y los envió hacia el espacio."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Taller 2 : 3D Webgl Application # Planteamiento del problema # Implementación de una aplicación webgl 3d. a través de la utilización de p5.treegl o otra librería.
Main spaces # Sistema Tierra-Luna : # La luna es para el planeta tierra eje fundamental de estaciones y mareas, los científicos creen que un objeto del tamaño de Marte colisionó con la Tierra hace 4.500 millones de años. La fuerza de esta colisión fue tan impresionante que desprendió materiales de la Tierra y del objeto con el que colisionó y los envió hacia el espacio."><meta property="og:type" content="article"><meta property="og:url" content="https://emmendezp.github.io/RGB/docs/Talleres/Main-Spaces/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-10-26T08:09:04-05:00"><title>Main Spaces | Computacion Visual 2022-2 RGB</title><link rel=manifest href=/RGB/manifest.json><link rel=icon href=/RGB/favicon.png type=image/x-icon><link rel=stylesheet href=/RGB/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/RGB/flexsearch.min.js></script>
<script defer src=/RGB/en.search.min.8b0f9a4d41d8f12b8e54b9b3938cfdc3e76269a4430ee17922c6ba5b49bd88de.js integrity="sha256-iw+aTUHY8SuOVLmzk4z9w+diaaRDDuF5Isa6W0m9iN4=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/RGB/><span>Computacion Visual 2022-2 RGB</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-bab8b9365022340ebec5653746d3d735 class=toggle>
<label for=section-bab8b9365022340ebec5653746d3d735 class="flex justify-between"><a href=/RGB/docs/Ejercicios/>Ejercicios</a></label><ul><li><a href=/RGB/docs/Ejercicios/Ejercicio1/>Ejercicio1</a></li><li><a href=/RGB/docs/Ejercicios/Ejercicio2/>Ejercicio2</a></li><li><a href=/RGB/docs/Ejercicios/Ejercicio3/>Ejercicio3</a></li></ul></li><li><input type=checkbox id=section-9370f1a5d0248572ac505e0c6d4ad190 class=toggle>
<label for=section-9370f1a5d0248572ac505e0c6d4ad190 class="flex justify-between"><a href=/RGB/docs/shortcodes/>Shortcodes</a></label><ul><li><a href=/RGB/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/RGB/docs/shortcodes/columns/>Columns</a></li><li><a href=/RGB/docs/shortcodes/details/>Details</a></li><li><a href=/RGB/docs/shortcodes/hints/>Hints</a></li><li><a href=/RGB/docs/shortcodes/katex/>Katex</a></li><li><a href=/RGB/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between"><a href=/RGB/docs/shortcodes/p5/>P5</a></label><ul><li><a href=/RGB/docs/shortcodes/p5/div/>Div</a></li><li><a href=/RGB/docs/shortcodes/p5/iframe/>Iframe</a></li></ul></li><li><a href=/RGB/docs/shortcodes/tabs/>Tabs</a></li></ul></li><li><input type=checkbox id=section-042d3f228c0d48b7873225f7fc71e929 class=toggle checked>
<label for=section-042d3f228c0d48b7873225f7fc71e929 class="flex justify-between"><a href=/RGB/docs/Talleres/>Talleres</a></label><ul><li><a href=/RGB/docs/Talleres/Main-Spaces/ class=active>Main Spaces</a></li><li><a href=/RGB/docs/Talleres/visual_ilusions/>Visual Ilusions</a></li><li><a href=/RGB/docs/Talleres/visual_Masking/>Visual Masking</a></li></ul></li></ul><ul><li><a href=/RGB/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/RGB/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Main Spaces</strong>
<label for=toc-control><img src=/RGB/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#taller-2---3d-webgl-application>Taller 2 : 3D Webgl Application</a><ul><li><a href=#planteamiento-del-problema>Planteamiento del problema</a></li><li><a href=#main-spaces>Main spaces</a></li><li><a href=#sistema-tierra-luna->Sistema Tierra-Luna :</a></li><li><a href=#herramientas-a-utilizar>Herramientas a utilizar:</a></li><li><a href=#webgl-web-graphics-library>WEBGL (Web Graphics Library)</a></li><li><a href=#sistema-de-coordenadas-3d>Sistema de coordenadas 3D</a></li><li><a href=#código-y-resultado>Código y Resultado:</a><ul><li><a href=#inicialización-del-scriptbr>Inicialización del script<br></a></li><li><a href=#función-preload>Función Preload</a></li><li><a href=#create-canvas>Create Canvas</a></li><li><a href=#rotate>Rotate</a></li></ul></li><li><a href=#resultado>Resultado</a></li><li><a href=#proyecto-laberinto>Proyecto Laberinto</a></li><li><a href=#aplicaciones>Aplicaciones</a></li><li><a href=#conclusiones-y-trabajo-a-futuro>Conclusiones y trabajo a futuro</a></li></ul></li><li><a href=#bibliografía>Bibliografía</a></li></ul></nav></aside></header><article class=markdown><h1 id=taller-2---3d-webgl-application>Taller 2 : 3D Webgl Application
<a class=anchor href=#taller-2---3d-webgl-application>#</a></h1><h2 id=planteamiento-del-problema>Planteamiento del problema
<a class=anchor href=#planteamiento-del-problema>#</a></h2><p>Implementación de una aplicación webgl 3d. a través de la utilización de p5.treegl o otra librería.</p><h2 id=main-spaces>Main spaces
<a class=anchor href=#main-spaces>#</a></h2><h2 id=sistema-tierra-luna->Sistema Tierra-Luna :
<a class=anchor href=#sistema-tierra-luna->#</a></h2><p><a href=https://commons.wikimedia.org/wiki/File:Moon_Earth_Comparison.png><img src=https://upload.wikimedia.org/wikipedia/commons/f/f6/Moon_Earth_Comparison.png title="source: From Wikimedia Commons, the free media repository"></a></p><p>La luna es para el planeta tierra eje fundamental de estaciones y mareas, los científicos creen que un objeto del tamaño de Marte colisionó con la Tierra hace 4.500 millones de años. La fuerza de esta colisión fue tan impresionante que desprendió materiales de la Tierra y del objeto con el que colisionó y los envió hacia el espacio. Parte de estos escombros se juntó para formar la Luna.</p><p>La Luna no solo se formó principalmente con materiales de la Tierra, sino que probablemente una gran cantidad de escombros de la Tierra aterrizaron en la Luna en el período posterior a su formación. Podría haber más indicios sobre la composición de la Tierra primordial ocultos entre las capas de polvo lunar.</p><p>Sin la gravedad de la Luna, la Tierra se tambalearía más violentamente sobre su eje, alterando así drásticamente el clima. Además de mantener la estabilidad del clima, la Luna marca el ritmo de la Tierra (las subidas y las bajadas de las mareas), lo que afecta la variedad de maneras en que usamos el océano para alimentarnos, viajar y recrearnos.</p><p>El modelado 3D consiste en utilizar software para crear una representación matemática de un objeto o forma tridimensional. El objeto creado se denomina modelo 3D y se utiliza en distintas industrias. Se puede visualizar como una imagen bidimensional mediante un proceso llamado renderizado 3D o utilizar en una simulación por computadora de fenómenos físicos.</p><h2 id=herramientas-a-utilizar>Herramientas a utilizar:
<a class=anchor href=#herramientas-a-utilizar>#</a></h2><p>Uno de los dos modos de renderizado en p5.js: P2D (renderizador predeterminado) y WEBGL Habilita el renderizado 3D introduciendo la tercera dimensión: Z. Ambos modos de representación utilizan el elemento de lienzo html; sin embargo, al habilitar el &ldquo;contexto&rdquo; WEBGL en el lienzo, ahora podemos dibujar tanto en 2D como en 3D.</p><h2 id=webgl-web-graphics-library>WEBGL (Web Graphics Library)
<a class=anchor href=#webgl-web-graphics-library>#</a></h2><p>Es una especificación estándar que define una API implementada en JavaScript para la renderización de gráficos en 3D dentro de cualquier navegador web. No precisa del uso de plug-ins adicionales en cualquier plataforma que soporte OpenGL 2.0 u OpenGL ES 2.0. WebGL está integrada completamente en todos los estándares web del navegador, permitiendo la aceleración hardware (física) de la GPU y el procesamiento de imágenes y efectos como parte del lienzo o &ldquo;canvas&rdquo; de la página web. Los elementos de WebGL se pueden combinar con otros elementos HTML y estar compuestos con otras partes de la página o del fondo (background) de la página.</p><p>sintaxis WEBGL:<br><a href=#><img src=https://imgur.com/2KlDlVU.png title="source: From imgur"></a></p><h2 id=sistema-de-coordenadas-3d>Sistema de coordenadas 3D
<a class=anchor href=#sistema-de-coordenadas-3d>#</a></h2><p>La coordenada cartesiana 0,0 (x,y) se encuentra en la esquina superior izquierda del lienzo de dibujo. En el modo WEBGL introducimos una tercera dimensión: Z. La dimensión z es el eje que apunta hacia usted desde la pantalla.</p><p><a href=https://commons.wikimedia.org/wiki/File:3D_coordinate_system.svg><img src=https://upload.wikimedia.org/wikipedia/commons/2/2c/3D_coordinate_system.svg title="source: From Wikimedia Commons, the free media repository"></a></p><p><a href=https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Euler2.gif/300px-Euler2.gif><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Euler2.gif/300px-Euler2.gif title="source: From Wikimedia Commons, the free media repository"></a></p><h2 id=código-y-resultado>Código y Resultado:
<a class=anchor href=#c%c3%b3digo-y-resultado>#</a></h2><h3 id=inicialización-del-scriptbr>Inicialización del script<br><a class=anchor href=#inicializaci%c3%b3n-del-scriptbr>#</a></h3><img src=https://imgur.com/21UNy3u.png title="Inicialización del script"><h3 id=función-preload>Función Preload
<a class=anchor href=#funci%c3%b3n-preload>#</a></h3><p>Nos permite cargar nuestras imágenes a utilizar, como se observa en las líneas de código son especificas que imagenes utiliza nuestro proyecto.<br><img src=https://imgur.com/IPEeysZ.png title="Función Preload"></p><h3 id=create-canvas>Create Canvas
<a class=anchor href=#create-canvas>#</a></h3><p>la cual en estas líneas está representada la luz con el respectivo eje de rotación permitiendo una visualización de sombra que se ve reflejada en el planeta tierra.<br><img src=https://imgur.com/YRqWe2N.png title="Create Canvas"></p><h3 id=rotate>Rotate
<a class=anchor href=#rotate>#</a></h3><p>Esta función nos permite utilizar la rotación y dar una perspectiva de movimiento donde la tierra gira en su propio eje y la luna alrededor de la tierra, aun así la luna gira gira en su propio eje, no obstante cabe aclarar que utilizamos push y pop como funciones.<br><img src=https://imgur.com/mutxY4g.png title=Rotate></p><h2 id=resultado>Resultado
<a class=anchor href=#resultado>#</a></h2><p>Se puede observar una imagen, la cual representa la implementación en 3D de la tierra y la luna con un fondo de estrellas, la cual simula la respectiva rotación.<br><img src=https://imgur.com/eW3Ipti.png title=Resultado></p><p><details><summary>CODE</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Code</span> <span style=color:#a6e22e>Earth</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>Moon</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#a6e22e>DOCTYPE</span> <span style=color:#a6e22e>html</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>head</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>title</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Tierra</span> <span style=color:#a6e22e>y</span> <span style=color:#a6e22e>Luna</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/title&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js&#34;</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/head&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>body</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>textura_tierra</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;https://i.ibb.co/PD4LyP5/planeta.jpg&#39;</span>);
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>textura_luna</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;https://i.ibb.co/WPvVybx/luna.jpg&#39;</span>);
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>textura_fondo_estrellas</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#34;https://i.ibb.co/NNTFKmL/nocheHD.jpg&#34;</span>)
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>800</span>, <span style=color:#ae81ff>450</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>background</span>(<span style=color:#e6db74>&#34;black&#34;</span>)
</span></span><span style=display:flex><span>               
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>noStroke</span>() <span style=color:#75715e>//No dibujar la malla de las esferas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>               
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>textura_fondo_estrellas</span>)
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>800</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>               <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>directionalLight</span>(
</span></span><span style=display:flex><span>                         <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>25</span>,<span style=color:#75715e>//Color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                         <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#75715e>//Dirección
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    );
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>orbitControl</span>() <span style=color:#75715e>//Controlar con el mouse la cámara
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>rotateZ</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>0.3</span>) <span style=color:#75715e>//Inclinación de la tierra
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.01</span>); <span style=color:#75715e>//rotación de la tierra sobre su propio eje
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>               <span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>textura_tierra</span>); 
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>rotateY</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.05</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>);<span style=color:#75715e>//Traslación de la luna alrededor de la tierra
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>               <span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>170</span>)<span style=color:#75715e>//Distancia del centro de la luna al centro de la tierra
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>               <span style=color:#a6e22e>rotateY</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.05</span>);<span style=color:#75715e>//Rotación de la luna sobre su propio eje
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>               <span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>textura_luna</span>);
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>25</span>);
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/body&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/html&gt;</span>
</span></span></code></pre></div></div></details><iframe id=breath style=width:720px;height:450px srcdoc='
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script>
              

Code Earth and Moon
<!DOCTYPE html>
<html lang="en">

<head>
     <title>Tierra y Luna</title>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
</head>

<body>

     <script>

          function preload() {
               textura_tierra = loadImage(&#39;https://i.ibb.co/PD4LyP5/planeta.jpg&#39;);
               textura_luna = loadImage(&#39;https://i.ibb.co/WPvVybx/luna.jpg&#39;);
               textura_fondo_estrellas = loadImage("https://i.ibb.co/NNTFKmL/nocheHD.jpg")
          }

          function setup() {
               createCanvas(800, 450, WEBGL);
          }

          function draw() {
               background("black")
               
               noStroke() //No dibujar la malla de las esferas
               
               texture(textura_fondo_estrellas)
               sphere(800)

               for (let i = 0; i < 3; i++) {
                    directionalLight(
                         255, 255, 255 - i * 25,//Color
                         -1, 1, -1 //Dirección
                    );
               }

               orbitControl() //Controlar con el mouse la cámara

               rotateZ(-0.3) //Inclinación de la tierra

               push()
               rotateY(frameCount * 0.01); //rotación de la tierra sobre su propio eje
               texture(textura_tierra); 
               sphere(100);
               pop()

               push()
               rotateY(-frameCount * 0.05 / 10);//Traslación de la luna alrededor de la tierra
               translate(0, 0, 170)//Distancia del centro de la luna al centro de la tierra
               rotateY(-frameCount * 0.05);//Rotación de la luna sobre su propio eje
               texture(textura_luna);
               sphere(25);
               pop()
          }

     </script>

</body>

</html>



            </script>
          </head>
          <body>
          </body>
        </html>
      '></iframe></p><h2 id=proyecto-laberinto>Proyecto Laberinto
<a class=anchor href=#proyecto-laberinto>#</a></h2><details><summary>Laberinto</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MAP_NUM_ROWS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MAP_NUM_COLS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MAP_NUM_COLS</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WINDOW_HEIGHT</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MAP_NUM_ROWS</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// const VISION_ANGLE = 2*Math.PI ;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VISION_ANGLE</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>RAY_WIDTH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; <span style=color:#75715e>// can be increased for optimization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NUM_RAYS</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>RAY_WIDTH</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Map</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>grid</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>WINDOW_WIDTH</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>WINDOW_HEIGHT</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>WINDOW_HEIGHT</span>) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>TILE_SIZE</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>TILE_SIZE</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>grid</span>[<span style=color:#a6e22e>j</span>][<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>MAP_NUM_ROWS</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>MAP_NUM_COLS</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tileX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tileY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tileColor</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>grid</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;#fff&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#000&#34;</span>; <span style=color:#75715e>// colores minimapa
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;#222&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>tileColor</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tileX</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tileY</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Player</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>570</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;      <span style=color:#75715e>//-1 for left , 1 for right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;      <span style=color:#75715e>//-1 for back , 1 for front
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;      <span style=color:#75715e>//-1 for back , 1 for front
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span> <span style=color:#f92672>=</span>  <span style=color:#f92672>-</span>Math.<span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>moveSpeed</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5.0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationSpeed</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> (Math.<span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>180</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>update</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationSpeed</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// this.rotationAngle = normalizeAngle(this.rotationAngle)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>moveStep</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>moveSpeed</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>newPlayerX</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>moveStep</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>newPlayerY</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>moveStep</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>newPlayerX</span>, <span style=color:#a6e22e>newPlayerY</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newPlayerX</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newPlayerY</span>;
</span></span><span style=display:flex><span>            <span style=color:#75715e>// console.log(this);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strafeDirection</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>newX</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>moveSpeed</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>newY</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>moveSpeed</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>newX</span>, <span style=color:#a6e22e>newY</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newX</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newY</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#34;blue&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>circle</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>radius</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;blue&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>line</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>30</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rotationAngle</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Ray</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>rayAngle</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>normalizeAngle</span>(<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wasHitVertical</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingDown</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> Math.<span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingUp</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingDown</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingRight</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1.5</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingLeft</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingRight</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cast</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>xintercept</span>, <span style=color:#a6e22e>yintercept</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>xstep</span>, <span style=color:#a6e22e>ystep</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>///////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// HORIZONTAL RAY-GRID INTERSECTION CODE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>///////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>foundHorzWallHit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>horzWallHitX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>horzWallHitY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>horWallColor</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Find the y-coordinate of the closest horizontal grid intersenction
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>yintercept</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>TILE_SIZE</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>yintercept</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingDown</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Find the x-coordinate of the closest horizontal grid intersection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>xintercept</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>yintercept</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span>) <span style=color:#f92672>/</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Calculate the increment xstep and ystep
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>*=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingUp</span> <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>/</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>*=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingLeft</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>*=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingRight</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nextHorzTouchX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>xintercept</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>yintercept</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Increment xstep and ystep until we find a wall
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>nextHorzTouchX</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextHorzTouchX</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>WINDOW_HEIGHT</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>nextHorzTouchX</span>, <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>-</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingUp</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>)) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>foundHorzWallHit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>horzWallHitX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nextHorzTouchX</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>horzWallHitY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nextHorzTouchY</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>horWallColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>nextHorzTouchX</span>, <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>-</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingUp</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>nextHorzTouchX</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>xstep</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>nextHorzTouchY</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>ystep</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>///////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// VERTICAL RAY-GRID INTERSECTION CODE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>///////////////////////////////////////////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>foundVertWallHit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>vertWallHitX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>vertWallHitY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>verWallColor</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Find the x-coordinate of the closest vertical grid intersenction
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>xintercept</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>TILE_SIZE</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xintercept</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingRight</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Find the y-coordinate of the closest vertical grid intersection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>yintercept</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>xintercept</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Calculate the increment xstep and ystep
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TILE_SIZE</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xstep</span> <span style=color:#f92672>*=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingLeft</span> <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>*=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingUp</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>*=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingDown</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ystep</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>xintercept</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nextVertTouchY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>yintercept</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Increment xstep and ystep until we find a wall
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextVertTouchY</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>nextVertTouchY</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>WINDOW_HEIGHT</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>-</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingLeft</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>), <span style=color:#a6e22e>nextVertTouchY</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>foundVertWallHit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>vertWallHitX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nextVertTouchX</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>vertWallHitY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nextVertTouchY</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>verWallColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>hasWallAt</span>(<span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>-</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRayFacingLeft</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>), <span style=color:#a6e22e>nextVertTouchY</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>nextVertTouchX</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>xstep</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>nextVertTouchY</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>ystep</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Calculate both horizontal and vertical distances and choose the smallest value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>horzHitDistance</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>foundHorzWallHit</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>?</span> <span style=color:#a6e22e>calculateDistance</span>(<span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>horzWallHitX</span>, <span style=color:#a6e22e>horzWallHitY</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>:</span> Number.<span style=color:#a6e22e>MAX_VALUE</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>vertHitDistance</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>foundVertWallHit</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>?</span> <span style=color:#a6e22e>calculateDistance</span>(<span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>vertWallHitX</span>, <span style=color:#a6e22e>vertWallHitY</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>:</span> Number.<span style=color:#a6e22e>MAX_VALUE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only store the smallest of the distances
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>vertHitDistance</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>horzHitDistance</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vertWallHitX</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vertWallHitY</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vertHitDistance</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verWallColor</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wasHitVertical</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>horzWallHitX</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>horzWallHitY</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>horzHitDistance</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>horWallColor</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wasHitVertical</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;rgba(255, 0, 0, 1.0)&#34;</span>);<span style=color:#75715e>//visor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>line</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitX</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>MINIMAP_SCALE_FACTOR</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallHitY</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>player</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>grid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rays</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>normalizeAngle</span>(<span style=color:#a6e22e>angle</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>%</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>angle</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>angle</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>angle</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>calculateDistance</span>(<span style=color:#a6e22e>x1</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x2</span>, <span style=color:#a6e22e>y2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>((<span style=color:#a6e22e>x2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>x1</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>x2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>x1</span>) <span style=color:#f92672>+</span> (<span style=color:#a6e22e>y2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y1</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>y2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y1</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>castAllRays</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>rotationAngle</span> <span style=color:#f92672>-</span> (<span style=color:#a6e22e>VISION_ANGLE</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rays</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>NUM_RAYS</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ray</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Ray</span>(<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>cast</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rays</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>ray</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>VISION_ANGLE</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>NUM_RAYS</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>render3DProjectedWalls</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// loop every ray in the array of rays
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>NUM_RAYS</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ray</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rays</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// get the perpendicular distance to the wall to fix fishbowl distortion
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>correctWallDistance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>distance</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>rotationAngle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// calculate the distance to the projection plane
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>distanceProjectionPlane</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>WINDOW_WIDTH</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>/</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#a6e22e>VISION_ANGLE</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// projected wall height
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rayHeight</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>TILE_SIZE</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>correctWallDistance</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>distanceProjectionPlane</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// compute the transparency based on the wall distance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>alpha</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>; <span style=color:#75715e>//170 / correctWallDistance;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>alpha</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>180</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>correctWallDistance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>alpha</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wasHitVertical</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0.8</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// render a rectangle with the calculated wall height
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// fill(&#34;rgba(&#34; + color + &#34;,&#34; + color/3 + &#34;,&#34; + color/.3 + &#34;,&#34; + alpha + &#34;)&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>colorR</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>108</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>39</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>colorG</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>145</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>145</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>160</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>colorB</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>70</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>190</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>wallColor</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>100</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#39;#C2F9E9&#39;</span>)<span style=color:#75715e>//cielo
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>WINDOW_HEIGHT</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>-</span> (<span style=color:#a6e22e>rayHeight</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#34;rgba(&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>colorR</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>colorG</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>colorB</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>alpha</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>); <span style=color:#75715e>//paredes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>WINDOW_HEIGHT</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>-</span> (<span style=color:#a6e22e>rayHeight</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayHeight</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#39;#FFE689&#39;</span>)<span style=color:#75715e>//s
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>WINDOW_HEIGHT</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayHeight</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>rayHeight</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>RAY_WIDTH</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>WINDOW_HEIGHT</span> <span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>(<span style=color:#a6e22e>WEBGL</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// initialize all objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>createCanvas</span>(<span style=color:#a6e22e>WINDOW_WIDTH</span>, <span style=color:#a6e22e>WINDOW_HEIGHT</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// update game objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>update</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>castAllRays</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// render objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>clear</span>(<span style=color:#e6db74>&#34;#111&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>update</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render3DProjectedWalls</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// fill(&#39;#eee&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>render</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ray</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>rays</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ray</span>.<span style=color:#a6e22e>render</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>render</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// console.log(keyCode);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>keyCode</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UP_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>DOWN_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>RIGHT_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>LEFT_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>33</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>34</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyReleased</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>keyCode</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UP_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>DOWN_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>walkDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>RIGHT_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>LEFT_ARROW</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>turnDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>33</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>34</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>strafeDirection</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// setup()
</span></span></span></code></pre></div></div></details><iframe id=breath style=width:720px;height:450px srcdoc='
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script>
              
const TILE_SIZE = 64;
const MAP_NUM_ROWS = 10;
const MAP_NUM_COLS = 16;
const WINDOW_WIDTH = MAP_NUM_COLS * TILE_SIZE;
const WINDOW_HEIGHT = MAP_NUM_ROWS * TILE_SIZE;
const MINIMAP_SCALE_FACTOR = 0.2;
// const VISION_ANGLE = 2*Math.PI ;
const VISION_ANGLE = Math.PI / 3;
const RAY_WIDTH = 2; // can be increased for optimization
const NUM_RAYS = WINDOW_WIDTH / RAY_WIDTH;
class Map {
    constructor() {
        this.grid = [
            [1, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 1],
            [2, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [2, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1]
        ];
        this.width = WINDOW_WIDTH;
        this.height = WINDOW_HEIGHT;
    }
    hasWallAt(x, y) {
        if (x <= 0 || y <= 0 || x > WINDOW_WIDTH || y > WINDOW_HEIGHT) return true;
        var i = Math.floor(x / TILE_SIZE)
        var j = Math.floor(y / TILE_SIZE)
        return this.grid[j][i];
    }

    render() {
        for (var i = 0; i < MAP_NUM_ROWS; i++) {
            for (var j = 0; j < MAP_NUM_COLS; j++) {
                var tileX = j * TILE_SIZE;
                var tileY = i * TILE_SIZE;
                var tileColor = this.grid[i][j] == 0 ? "#fff" : "#000"; // colores minimapa
                stroke("#222");
                fill(tileColor);
                rect(
                    MINIMAP_SCALE_FACTOR * tileX,
                    MINIMAP_SCALE_FACTOR * tileY,
                    MINIMAP_SCALE_FACTOR * TILE_SIZE,
                    MINIMAP_SCALE_FACTOR * TILE_SIZE
                );
            }
        }
    }
}

class Player {
    constructor() {
        this.x = 100;
        this.y = 570;
        this.radius = 4;
        this.turnDirection = 0;      //-1 for left , 1 for right
        this.walkDirection = 0;      //-1 for back , 1 for front
        this.strafeDirection = 0;      //-1 for back , 1 for front
        this.rotationAngle =  -Math.PI / 2;
        this.moveSpeed = 5.0;
        this.rotationSpeed = 3 * (Math.PI / 180)

    }
    update() {
        this.rotationAngle += this.turnDirection * this.rotationSpeed;
        // this.rotationAngle = normalizeAngle(this.rotationAngle)
        var moveStep = this.walkDirection * this.moveSpeed;

        var newPlayerX = this.x + Math.cos(this.rotationAngle) * moveStep;
        var newPlayerY = this.y + Math.sin(this.rotationAngle) * moveStep;

        if (grid.hasWallAt(newPlayerX, newPlayerY) == 0) {
            this.x = newPlayerX;
            this.y = newPlayerY;
            // console.log(this);
        }
        if (this.strafeDirection) {

            var newX = this.x + this.strafeDirection * this.moveSpeed * Math.sin(this.rotationAngle);
            var newY = this.y + this.strafeDirection * this.moveSpeed * Math.cos(this.rotationAngle);
            if (grid.hasWallAt(newX, newY) !== 0) {
                this.x = newX;
                this.y = newY;
            }
        }
    }
    render() {
        noStroke();
        fill("blue");
        circle(
            MINIMAP_SCALE_FACTOR * this.x,
            MINIMAP_SCALE_FACTOR * this.y,
            MINIMAP_SCALE_FACTOR * this.radius
        );
        stroke("blue");
        line(
            MINIMAP_SCALE_FACTOR * this.x,
            MINIMAP_SCALE_FACTOR * this.y,
            MINIMAP_SCALE_FACTOR * (this.x + Math.cos(this.rotationAngle) * 30),
            MINIMAP_SCALE_FACTOR * (this.y + Math.sin(this.rotationAngle) * 30)
        );
    }
}

class Ray {
    constructor(rayAngle) {
        this.rayAngle = normalizeAngle(rayAngle);
        this.wallHitX = 0;
        this.wallHitY = 0;
        this.distance = 0;
        this.wasHitVertical = false;
        this.wallColor = 0;
        this.isRayFacingDown = this.rayAngle > 0 && this.rayAngle < Math.PI;
        this.isRayFacingUp = !this.isRayFacingDown;

        this.isRayFacingRight = this.rayAngle < 0.5 * Math.PI || this.rayAngle > 1.5 * Math.PI;
        this.isRayFacingLeft = !this.isRayFacingRight;
    }
    cast() {
        var xintercept, yintercept;
        var xstep, ystep;

        ///////////////////////////////////////////
        // HORIZONTAL RAY-GRID INTERSECTION CODE
        ///////////////////////////////////////////
        var foundHorzWallHit = false;
        var horzWallHitX = 0;
        var horzWallHitY = 0;
        var horWallColor = 0

        // Find the y-coordinate of the closest horizontal grid intersenction
        yintercept = Math.floor(player.y / TILE_SIZE) * TILE_SIZE;
        yintercept += this.isRayFacingDown ? TILE_SIZE : 0;

        // Find the x-coordinate of the closest horizontal grid intersection
        xintercept = player.x + (yintercept - player.y) / Math.tan(this.rayAngle);

        // Calculate the increment xstep and ystep
        ystep = TILE_SIZE;
        ystep *= this.isRayFacingUp ? -1 : 1;

        xstep = TILE_SIZE / Math.tan(this.rayAngle);
        xstep *= (this.isRayFacingLeft && xstep > 0) ? -1 : 1;
        xstep *= (this.isRayFacingRight && xstep < 0) ? -1 : 1;

        var nextHorzTouchX = xintercept;
        var nextHorzTouchY = yintercept;

        // Increment xstep and ystep until we find a wall
        while (nextHorzTouchX >= 0 && nextHorzTouchX <= WINDOW_WIDTH && nextHorzTouchY >= 0 && nextHorzTouchY <= WINDOW_HEIGHT) {
            if (grid.hasWallAt(nextHorzTouchX, nextHorzTouchY - (this.isRayFacingUp ? 1 : 0)) !== 0) {
                foundHorzWallHit = true;
                horzWallHitX = nextHorzTouchX;
                horzWallHitY = nextHorzTouchY;
                horWallColor = grid.hasWallAt(nextHorzTouchX, nextHorzTouchY - (this.isRayFacingUp ? 1 : 0))
                break;
            } else {
                nextHorzTouchX += xstep;
                nextHorzTouchY += ystep;
            }
        }

        ///////////////////////////////////////////
        // VERTICAL RAY-GRID INTERSECTION CODE
        ///////////////////////////////////////////
        var foundVertWallHit = false;
        var vertWallHitX = 0;
        var vertWallHitY = 0;
        var verWallColor = 0

        // Find the x-coordinate of the closest vertical grid intersenction
        xintercept = Math.floor(player.x / TILE_SIZE) * TILE_SIZE;
        xintercept += this.isRayFacingRight ? TILE_SIZE : 0;

        // Find the y-coordinate of the closest vertical grid intersection
        yintercept = player.y + (xintercept - player.x) * Math.tan(this.rayAngle);

        // Calculate the increment xstep and ystep
        xstep = TILE_SIZE;
        xstep *= this.isRayFacingLeft ? -1 : 1;

        ystep = TILE_SIZE * Math.tan(this.rayAngle);
        ystep *= (this.isRayFacingUp && ystep > 0) ? -1 : 1;
        ystep *= (this.isRayFacingDown && ystep < 0) ? -1 : 1;

        var nextVertTouchX = xintercept;
        var nextVertTouchY = yintercept;

        // Increment xstep and ystep until we find a wall
        while (nextVertTouchX >= 0 && nextVertTouchX <= WINDOW_WIDTH && nextVertTouchY >= 0 && nextVertTouchY <= WINDOW_HEIGHT) {
            if (grid.hasWallAt(nextVertTouchX - (this.isRayFacingLeft ? 1 : 0), nextVertTouchY) !== 0) {
                foundVertWallHit = true;
                vertWallHitX = nextVertTouchX;
                vertWallHitY = nextVertTouchY;
                verWallColor = grid.hasWallAt(nextVertTouchX - (this.isRayFacingLeft ? 1 : 0), nextVertTouchY)
                break;
            } else {
                nextVertTouchX += xstep;
                nextVertTouchY += ystep;
            }
        }

        // Calculate both horizontal and vertical distances and choose the smallest value
        var horzHitDistance = (foundHorzWallHit)
            ? calculateDistance(player.x, player.y, horzWallHitX, horzWallHitY)
            : Number.MAX_VALUE;
        var vertHitDistance = (foundVertWallHit)
            ? calculateDistance(player.x, player.y, vertWallHitX, vertWallHitY)
            : Number.MAX_VALUE;

        // only store the smallest of the distances
        if (vertHitDistance < horzHitDistance) {
            this.wallHitX = vertWallHitX;
            this.wallHitY = vertWallHitY;
            this.distance = vertHitDistance;
            this.wallColor = verWallColor
            this.wasHitVertical = true;
        } else {
            this.wallHitX = horzWallHitX;
            this.wallHitY = horzWallHitY;
            this.distance = horzHitDistance;
            this.wallColor = horWallColor
            this.wasHitVertical = false;
        }
    }
    render() {
        stroke("rgba(255, 0, 0, 1.0)");//visor
        line(
            MINIMAP_SCALE_FACTOR * player.x,
            MINIMAP_SCALE_FACTOR * player.y,
            MINIMAP_SCALE_FACTOR * this.wallHitX,
            MINIMAP_SCALE_FACTOR * this.wallHitY
        );
    }
}

var player = new Player()
var grid = new Map()
var rays = []

function normalizeAngle(angle) {
    angle = angle % (2 * Math.PI);
    if (angle < 0) {
        angle = (2 * Math.PI) + angle;
    }
    return angle;
}

function calculateDistance(x1, y1, x2, y2) {
    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));

}
function castAllRays() {

    var rayAngle = player.rotationAngle - (VISION_ANGLE / 2);

    rays = [];
    for (var i = 0; i < NUM_RAYS; i++) {
        var ray = new Ray(rayAngle);
        ray.cast()
        rays.push(ray);
        rayAngle += VISION_ANGLE / NUM_RAYS;
    }

}

function render3DProjectedWalls() {
    // loop every ray in the array of rays
    for (var i = 0; i < NUM_RAYS; i++) {
        var ray = rays[i];

        // get the perpendicular distance to the wall to fix fishbowl distortion
        var correctWallDistance = ray.distance
            * Math.cos(ray.rayAngle - player.rotationAngle);

        // calculate the distance to the projection plane
        var distanceProjectionPlane = (WINDOW_WIDTH / 2) / Math.tan(VISION_ANGLE / 2);

        // projected wall height
        var rayHeight = (TILE_SIZE / correctWallDistance) * distanceProjectionPlane;

        // compute the transparency based on the wall distance
        var alpha = 1.0; //170 / correctWallDistance;

        var alpha = 180 / correctWallDistance

        var alpha = ray.wasHitVertical ? 1 : 0.8;

        // render a rectangle with the calculated wall height
        // fill("rgba(" + color + "," + color/3 + "," + color/.3 + "," + alpha + ")");

        var colorR = ray.wallColor == 1 ? 108 : ray.wallColor == 2 ? 39 : ray.wallColor == 3 ? 60 : 255;
        var colorG = ray.wallColor == 1 ? 145 : ray.wallColor == 2 ? 145 : ray.wallColor == 3 ? 160 : 255;
        var colorB = ray.wallColor == 1 ? 70 : ray.wallColor == 2 ? 190 : ray.wallColor == 3 ? 100 : 255;
        noStroke();
        fill(&#39;#C2F9E9&#39;)//cielo
        rect(i * RAY_WIDTH,
            0,
            RAY_WIDTH,
            (WINDOW_HEIGHT / 2) - (rayHeight / 2))
        fill("rgba(" + colorR + ", " + colorG + ", " + colorB + ", " + alpha + ")"); //paredes
        rect(
            i * RAY_WIDTH,
            (WINDOW_HEIGHT / 2) - (rayHeight / 2),
            RAY_WIDTH,
            rayHeight
        );
        fill(&#39;#FFE689&#39;)//s
        rect(i * RAY_WIDTH,
            (WINDOW_HEIGHT - rayHeight) / 2 + rayHeight,
            RAY_WIDTH,
            WINDOW_HEIGHT /2)
    }
}


function setup(WEBGL) {
    // initialize all objects
    createCanvas(WINDOW_WIDTH, WINDOW_HEIGHT);
}

function update() {
    // update game objects
    player.update()
    castAllRays()

}

function draw() {
    // render objects
    clear("#111");
    update();

    render3DProjectedWalls();
    // fill(&#39;#eee&#39;)

    grid.render()
    for (const ray of rays) {
        ray.render()
    }
    player.render()
}

// actions

function keyPressed() {
    // console.log(keyCode);
    switch (keyCode) {
        case UP_ARROW:
            player.walkDirection = +1
            break;
        case DOWN_ARROW:
            player.walkDirection = -1
            break;
        case RIGHT_ARROW:
            player.turnDirection = +1
            break;
        case LEFT_ARROW:
            player.turnDirection = -1
            break;
        case 33:
            player.strafeDirection = +1
            break;
        case 34:
            player.strafeDirection = -1
            break;

        default:
            break;
    }
}
function keyReleased() {
    switch (keyCode) {
        case UP_ARROW:
            player.walkDirection = 0;
            break;
        case DOWN_ARROW:
            player.walkDirection = 0;
            break;
        case RIGHT_ARROW:
            player.turnDirection = 0;
            break;
        case LEFT_ARROW:
            player.turnDirection = 0;
            break;
        case 33:
            player.strafeDirection = 0;
            break;
        case 34:
            player.strafeDirection = 0;
            break;


        default:
            break;
    }
}


// setup()




            </script>
          </head>
          <body>
          </body>
        </html>
      '></iframe><h2 id=aplicaciones>Aplicaciones
<a class=anchor href=#aplicaciones>#</a></h2><p>Esta herramienta desarrollada permite aplicaciones en el ambito escolar y científico dando una imagen más clara de cómo es el comportamiento de nuestro satelite.</p><p>De manera general el modelado 3D tiene funciones que van más allá del diseño de una figura de acción para una película de animación. Con esta técnica también se ha beneficiado el campo de la medicina, representando modelos tridimensionales de la anatomía humana.</p><h2 id=conclusiones-y-trabajo-a-futuro>Conclusiones y trabajo a futuro
<a class=anchor href=#conclusiones-y-trabajo-a-futuro>#</a></h2><p>WebGL es una tecnología diseñada para trabajar directamente con la GPU y puede resultar demasiado tedioso y difícil de usar directamente sin algunas librerías de utilidad, La carga de escenas gráficas y objetos 3D en los formatos convencionales también es tedioso por lo que se han creado las bibliotecas JavaScript o algunas importadas a WebGL, para aportar esta funcionalidad adicional.</p><h1 id=bibliografía>Bibliografía
<a class=anchor href=#bibliograf%c3%ada>#</a></h1><ul><li><a href=https://github.com/processing/p5.js/wiki/Getting-started-with-WebGL-in-p5>Getting started with WebGL in p5 · processing/p5.js Wiki. (n.d.). GitHub. Retrieved October 12, 2022, from</a> por Processing Foundation</li><li><a href=https://solarsystem.nasa.gov/news/959/10-cosas-lo-que-aprendemos-sobre-la-tierra-estudiando-la-luna/>Centro de vuelo espacial Goddard de la NASA (Goddard Space Flight Center, & inglés), E. (2019, febrero 25). 10 Cosas: Lo que aprendemos sobre la Tierra estudiando la Luna. NASA Solar System Exploration. </a>, Por Isabelle Yan</li><li><a href=https://editor.p5js.org>P5.Js web editor. (s/f). P5js.org. Recuperado el 10 de octubre de 2022, de</a>, Por P5.js Org</li><li><a href=https://processing.org/tutorials/p3d>P3D. Processing. Recuperado el 12 de octubre de 2022, de </a>, Por Shiffman, D.</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/emmendezp/RGB/commit/1e67441317bd8b09169028808163042cf934bbb6 title='Last modified by jjmunozq | October 26, 2022' target=_blank rel=noopener><img src=/RGB/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 26, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#taller-2---3d-webgl-application>Taller 2 : 3D Webgl Application</a><ul><li><a href=#planteamiento-del-problema>Planteamiento del problema</a></li><li><a href=#main-spaces>Main spaces</a></li><li><a href=#sistema-tierra-luna->Sistema Tierra-Luna :</a></li><li><a href=#herramientas-a-utilizar>Herramientas a utilizar:</a></li><li><a href=#webgl-web-graphics-library>WEBGL (Web Graphics Library)</a></li><li><a href=#sistema-de-coordenadas-3d>Sistema de coordenadas 3D</a></li><li><a href=#código-y-resultado>Código y Resultado:</a><ul><li><a href=#inicialización-del-scriptbr>Inicialización del script<br></a></li><li><a href=#función-preload>Función Preload</a></li><li><a href=#create-canvas>Create Canvas</a></li><li><a href=#rotate>Rotate</a></li></ul></li><li><a href=#resultado>Resultado</a></li><li><a href=#proyecto-laberinto>Proyecto Laberinto</a></li><li><a href=#aplicaciones>Aplicaciones</a></li><li><a href=#conclusiones-y-trabajo-a-futuro>Conclusiones y trabajo a futuro</a></li></ul></li><li><a href=#bibliografía>Bibliografía</a></li></ul></nav></div></aside></main></body></html>